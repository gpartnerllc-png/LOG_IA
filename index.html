<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link rel='icon' type='image/png' href='https://images.yampi.me/assets/stores/droppfy/uploads/icon/65f3d8c635540.png'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droppfy | AI Logistics Global</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .ai-glow { box-shadow: 0 0 20px rgba(56, 189, 248, 0.2); }
        input, select { transition: all 0.2s ease; color: white; }
        input:focus { border-color: #38bdf8 !important; box-shadow: 0 0 10px rgba(56, 189, 248, 0.2); }
        .hidden { display: none; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 pb-6 border-b border-slate-700">
            <div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">DROPPFY LOGISTICS AI</h1>
                <p class="text-slate-400 text-sm">O Melhor Pre√ßo de Envio √© com a Droppfy</p>
            </div>
            <div class="text-right">
                <span class="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-xs font-mono">SISTEMA ATIVO</span>
                <p class="text-xs text-slate-500 mt-1">Status: <span id="currentDate">--/--/----</span> - <span id="currentTime" class="font-bold text-slate-300">00:00:00</span></p>
            </div>
        </header>

        <form id="formSandx" onsubmit="processarLogistica(event)" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="glass p-6 rounded-2xl ai-glow space-y-4">
                <h2 class="text-xl font-semibold mb-4 flex items-center"><span class="mr-2">üìç</span> Destina√ß√£o Detalhada</h2>
                
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-[10px] text-slate-400 mb-1 uppercase">CEP Origem</label>
                        <input type="text" id="cepOrigem" value="72915-484" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] text-slate-400 mb-1 uppercase">CEP Destino</label>
                        <input type="text" id="cepDestino" placeholder="00000-000" required class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Nome Completo</label>
                    <input type="text" id="nomeCliente" required class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">CPF ou CNPJ</label>
                    <input type="text" id="docCliente" required placeholder="000.000.000-00" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-[10px] text-slate-400 mb-1 uppercase">WhatsApp</label>
                        <input type="text" id="telCliente" required class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] text-slate-400 mb-1 uppercase">Bairro</label>
                        <input type="text" id="bairro" required class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Endere√ßo e N√∫mero</label>
                    <input type="text" id="endereco" required class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Refer√™ncia</label>
                    <input type="text" id="referencia" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm">
                </div>
            </div>

            <div class="glass p-6 rounded-2xl space-y-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center"><span class="mr-2">üì¶</span> Droppfy Packing</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-slate-800/50 rounded-xl border border-blue-500/30 text-center">
                        <p class="text-[10px] text-blue-400 uppercase">Sugest√£o de Caixa</p>
                        <p class="font-bold text-sm" id="ai-box-suggestion">Caixa Tipo M</p>
                    </div>
                    <div class="p-4 bg-slate-800/50 rounded-xl border border-emerald-500/30 text-center">
                        <p class="text-[10px] text-emerald-400 uppercase">Seguran√ßa</p>
                        <p class="font-bold text-sm">SSL-AES</p>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Dimens√µes (cm)</label>
                    <div class="flex gap-2">
                        <input type="number" id="alt" placeholder="Alt" value="20" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
                        <input type="number" id="larg" placeholder="Larg" value="20" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
                        <input type="number" id="comp" placeholder="Comp" value="20" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Peso da Carga</label>
                    <select id="peso" class="w-full bg-slate-900 p-3 rounded border border-slate-700">
                        <option value="1">At√© 1kg</option>
                        <option value="2">At√© 2kg</option>
                        <option value="5">At√© 5kg</option>
                        <option value="10">At√© 10kg</option>
                    </select>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Servi√ßo de Frete</label>
                    <select id="servico" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3">
                        <option value="04014">SEDEX (Fast Delivery)</option>
                        <option value="04510">PAC (Economic)</option>
                    </select>
                </div>
            </div>

            <div class="glass p-6 rounded-2xl border-l-4 border-blue-500 flex flex-col justify-between">
                <div>
                    <h2 class="text-xl font-semibold mb-4">‚ö° Painel de Checkout</h2>
                    <div id="displayValores" class="hidden space-y-3 mb-6 border-t border-slate-700 pt-4">
                        <div class="flex justify-between text-xs text-slate-400">
                            <span>Custo Log√≠stico:</span>
                            <span id="valorBase">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between text-lg font-bold text-emerald-400">
                            <span>Total Droppfy:</span>
                            <span id="valorFinal">R$ 0,00</span>
                        </div>
                        <div id="areaPix" class="mt-4 p-4 bg-white rounded-lg text-center">
                            <p class="text-black text-[10px] font-bold mb-2">ESCANEIE PARA PAGAR</p>
                            <img id="qrCodePix" src="" class="mx-auto" style="width:150px">
                        </div>
                        <button type="button" onclick="gerarNotaFiscal()" id="areaImpressao" class="hidden w-full mt-2 bg-green-600 hover:bg-green-500 text-white py-2 rounded text-xs font-bold uppercase">
                            üñ®Ô∏è Imprimir Declara√ß√£o
                        </button>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <button type="submit" id="btnMain" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all">
                        CALCULAR E GERAR PIX
                    </button>
                    <p class="text-[10px] text-center text-slate-500">Integrado ao Cluster SandxCDD Global</p>
                </div>
            </div>
        </form>
    </div>

    <script>
    const SANDX_CONFIG = {
        pix: "pago@droppfy.com",
        beneficiario: "Partner",
        cidade: "Aguas Lindas",
        token: "8539700676:AAH2YR3nb7uTyp2DUmeSqHRGZcQjU4anoVA",
        chat: "1703808186"
    };

    function gerarPixMestre(valor) {
        const formatar = (id, conteudo) => `${id}${conteudo.length.toString().padStart(2, '0')}${conteudo}`;
        const valorLimpo = parseFloat(valor).toFixed(2);
        const contaInfo = formatar('00', 'br.gov.bcb.pix') + formatar('01', SANDX_CONFIG.pix);
        
        let payload = "000201" + formatar('26', contaInfo) + "520400005303986" + formatar('54', valorLimpo) + "5802BR" + formatar('59', SANDX_CONFIG.beneficiario) + formatar('60', SANDX_CONFIG.cidade) + "62070503***6304";

        let crc = 0xFFFF;
        for (let i = 0; i < payload.length; i++) {
            crc ^= payload.charCodeAt(i) << 8;
            for (let j = 0; j < 8; j++) {
                if ((crc & 0x8000) !== 0) crc = (crc << 1) ^ 0x1021;
                else crc <<= 1;
            }
        }
        return payload + (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
    }

    async function processarLogistica(event) {
        event.preventDefault();
        const btn = document.getElementById('btnMain');
        btn.innerText = "IA CALCULANDO...";

        const dados = {
            nome: document.getElementById('nomeCliente').value,
            doc: document.getElementById('docCliente').value,
            tel: document.getElementById('telCliente').value,
            cepO: document.getElementById('cepOrigem').value.replace(/\D/g, ''),
            cepD: document.getElementById('cepDestino').value.replace(/\D/g, ''),
            bairro: document.getElementById('bairro').value,
            end: document.getElementById('endereco').value,
            peso: parseFloat(document.getElementById('peso').value),
            alt: parseFloat(document.getElementById('alt').value),
            larg: parseFloat(document.getElementById('larg').value),
            comp: parseFloat(document.getElementById('comp').value)
        };

        let custoBase = 15.88 + (Math.abs(parseInt(dados.cepO[0]) - parseInt(dados.cepD[0])) * 4.20) + (dados.peso * 2.15);
        custoBase += ((dados.alt * dados.larg * dados.comp) / 6000) * 3.10;
        // 2. DIFERENCIA√á√ÉO DE VALOR (SEDEX vs PAC)
    const tipoServico = document.getElementById('servico').value;
    let adicionalServico = 0;

    if (tipoServico === "04014") { // C√≥digo para SEDEX
        adicionalServico = 33.33; // O SEDEX √© sempre mais caro pela urg√™ncia
        // Voc√™ tamb√©m pode usar um multiplicador: custoBase *= 1.75;
   
    } else { // C√≥digo para PAC (ou outros)
        adicionalServico = 0; // PAC √© o pre√ßo base
    }

        const valorFinal = ((custoBase + 4.00) * 1.45).toFixed(2);
        const pix = gerarPixMestre(valorFinal);

        document.getElementById('displayValores').classList.remove('hidden');
        document.getElementById('valorBase').innerText = `R$ ${custoBase.toFixed(2).replace('.', ',')}`;
        document.getElementById('valorFinal').innerText = `R$ ${valorFinal.replace('.', ',')}`;
        document.getElementById('qrCodePix').src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(pix)}`;
        document.getElementById('areaImpressao').classList.remove('hidden');
        
        btn.innerText = "AGUARDANDO PAGAMENTO...";

        const msg = `üöÄ *NOVA LOG√çSTICA*\nüë§ *CLIENTE:* ${dados.nome}\nüìÑ *DOC:* ${dados.doc}\nüìû *WhatsApp:* ${dados.tel}\nüìç *CEP:* ${dados.cepD}\nüí∞ *VALOR:* R$ ${valorFinal}\n\nüîó *PIX:* \`${pix}\``;
        fetch(`https://api.telegram.org/bot${SANDX_CONFIG.token}/sendMessage`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ chat_id: SANDX_CONFIG.chat, text: msg, parse_mode: 'Markdown' })
        });
    }

    function gerarNotaFiscal() {
        const info = {
            nome: document.getElementById('nomeCliente').value,
            doc: document.getElementById('docCliente').value,
            end: document.getElementById('endereco').value,
            cep: document.getElementById('cepDestino').value,
            valor: document.getElementById('valorFinal').innerText
        };
        const win = window.open('', '', 'width=600,height=400');
        win.document.write(`<html><body style="font-family:sans-serif; border:1px solid #000; padding:20px;"><h2>DECLARA√á√ÉO DE CONTE√öDO</h2><hr><p>DESTINAT√ÅRIO: ${info.nome}</p><p>DOC: ${info.doc}</p><p>ENDERE√áO: ${info.end}</p><p>CEP: ${info.cep}</p><h3>VALOR: ${info.valor}</h3><script>window.print();<\/script></body></html>`);
        win.document.close();
    }

    setInterval(() => {
        const agora = new Date();
        document.getElementById('currentDate').innerText = agora.toLocaleDateString('pt-BR');
        document.getElementById('currentTime').innerText = agora.toLocaleTimeString('pt-BR');
    }, 1000);
    </script>
</body>
</html>
