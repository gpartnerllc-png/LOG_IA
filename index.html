<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta charset="ISO-8859-1">
    <base href="https://cws.correios.com.br/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droppfy | AI Logistics Global</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .ai-glow { box-shadow: 0 0 20px rgba(56, 189, 248, 0.2); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 pb-6 border-b border-slate-700">
            <div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
                    DROPPFY LOGISTICS AI
                </h1>
                <p class="text-slate-400 text-sm">O Melhor Pre√ßo de Envio √© com a Droppfy IA</p>
            </div>
            <div class="text-right">
                <span class="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-xs font-mono">SISTEMA ATIVO</span>
                <p class="text-xs text-slate-500 mt-1">Status: 11/02/2026 - 17:03</p>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="glass p-6 rounded-2xl ai-glow">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="mr-2">üìç</span> Destina√ß√£o Autom√°tica
                </h2>
                <form id="logisticsForm" action="sistemas/precosPrazos/prazos.cfm" method="POST">
                    <form id="formSandx" onsubmit="processarLogistica(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs text-slate-400 mb-1 uppercase">CEP de Origem</label>
                            <input type="text" name="cepOrigem" value="01001-000" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none transition">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 mb-1 uppercase">CEP de Destino</label>
                            <input type="text" name="cepDestino" placeholder="00000-000" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 mb-1 uppercase">Tipo de Servi√ßo (IA)</label>
                            <select name="servico" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3">
                                <option value="04014">SEDEX (Mais R√°pido)</option>
                                <option value="04510">PAC (Melhor Custo)</option>
                                <option value="04227">Mini Envios (Pe√ßas Pequenas)</option>
                            </select>
                        </div>
                    </div>
            </div>

            <div class="glass p-6 rounded-2xl">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="mr-2">üì¶</span> Envios Correios Droppfy Packing
                </h2>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-slate-800/50 rounded-xl border border-blue-500/30">
                        <p class="text-[10px] text-blue-400 uppercase">Sugest√£o de Caixa</p>
                        <p class="font-bold" id="ai-box-suggestion">Caixa Tipo M (Correios)</p>
                    </div>
                    <div class="p-4 bg-slate-800/50 rounded-xl border border-emerald-500/30">
                        <p class="text-[10px] text-emerald-400 uppercase">Seguran√ßa</p>
                        <p class="font-bold">Criptografia RSA</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex gap-2">
                        <input type="number" name="Altura" placeholder="Alt" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
                        <input type="number" name="Largura" placeholder="Larg" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
                        <input type="number" name="Comprimento" placeholder="Comp" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
                    </div>
                    <select name="peso" class="w-full bg-slate-900 p-3 rounded border border-slate-700">
                        <option value="1">At√© 1kg</option>
                        <option value="1">At√© 1,5kg</option>
                        <option value="1">At√© 2kg</option>
                        <option value="1">At√© 2,5kg</option>
                        <option value="1">At√© 3kg</option>
                        <option value="1">At√© 3,5kg</option>
                        <option value="1">At√© 4kg</option>
                        <option value="1">At√© 4,5kg</option>
                        <option value="5">At√© 5kg</option>
                        <option value="10">At√© 10kg</option>
                    </select>
                </div>
            </div>

            <div class="glass p-6 rounded-2xl border-l-4 border-blue-500">
                <h2 class="text-xl font-semibold mb-4">‚ö° Execu√ß√£o em Tempo Real</h2>
                <div class="space-y-4 text-sm">
                    <div class="flex justify-between">
                        <span class="text-slate-400">Tempo de Processamento IA:</span>
                        <span class="text-blue-400 font-mono">14ms</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-400">Risco de Extravio</span>
                        <span class="text-emerald-400 font-bold">0.02%</span>
                    </div>
                    <hr class="border-slate-700">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/40 transition-all transform hover:scale-[1.02]">
                        DESPACHAR AGORA
                    </button>
                    <p class="text-[10px] text-center text-slate-500 mt-2">
                        Integrado aos Sistemas Oficiais dos Correios
                    </p>
                </div>
                </form>
            </div>
        </div>
    </div>

</body>

    <script>
// Configura√ß√µes Globais do SandxCDD - AI Logistics Engine
// Baseado na tecnologia de otimiza√ß√£o de custos (Israel) e escalabilidade (USA)
const CONFIG_LOGISTICA = {
    margemLucro: 0.45,      // 15% de acr√©scimo sobre o valor oficial dos Correios
    taxaFixaManuseio: 4.00, // Valor fixo adicional por etiqueta (opcional)
    botToken: "8539700676:AAH2YR3nb7uTyp2DUmeSqHRGZcQjU4anoVA", // Obtenha no @BotFather
    chatId: "1703808186"              // Obtenha no @IDBot
};

/**
 * Calcula o pre√ßo final de log√≠stica aplicando a intelig√™ncia de neg√≥cio.
 * @param {number} precoOficial - Valor retornado pela API dos Correios.
 */
function calcularPrecoCustomizado(precoOficial) {
    // C√°lculo: (Valor Oficial + Taxa Fixa) * Margem de Lucro
    let precoComTaxa = precoOficial + CONFIG_LOGISTICA.taxaFixaManuseio;
    let precoFinal = precoComTaxa * (1 + CONFIG_LOGISTICA.margemLucro);
    
    console.log(`[SandxCDD AI] Oficial: R$ ${precoOficial.toFixed(2)}`);
    console.log(`[SandxCDD AI] Final com Margem: R$ ${precoFinal.toFixed(2)}`);
    
    return precoFinal.toFixed(2);
}

/**
 * Envia os dados do c√°lculo e envio diretamente para o Telegram.
 * Evita o erro 405 ao usar a API oficial do Telegram como Gateway.
 */
async function enviarParaTelegram(valorFinal, dadosOriginais) {
    const mensagem = `üì¶ *NOVO ENVIO DETECTADO - SandxCDD*\n\n` +
                     `üí∞ *Valor Cobrado:* R$ ${valorFinal}\n` +
                     `üìç *Status:* Processado via Flutter Engine\n` +
                     `üìÖ *Data:* ${new Date().toLocaleString('pt-BR')}`;

    try {
        await fetch(`https://api.telegram.org/bot${CONFIG_LOGISTICA.botToken}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: CONFIG_LOGISTICA.chatId,
                text: mensagem,
                parse_mode: 'Markdown'
            })
        });
        console.log("[SandxCDD] Notifica√ß√£o enviada ao Telegram com sucesso.");
    } catch (error) {
        console.error("[SandxCDD] Erro ao conectar com o Telegram:", error);
    }
}

/**
 * Interceptador de Mensagens (Bridge)
 * Escuta os eventos do app Flutter dos Correios e injeta a l√≥gica customizada.
 */
window.addEventListener("message", function(event) {
    // Verifica se a mensagem vem do sistema de frete
    if (event.data && (event.data.type === 'CALCULO_FRETE' || event.data.price)) {
        const valorOriginal = parseFloat(event.data.valor || event.data.price);
        
        if (!isNaN(valorOriginal)) {
            const valorSandx = calcularPrecoCustomizado(valorOriginal);
            enviarParaTelegram(valorSandx, event.data);
            
            // Opcional: Notifica a interface do usu√°rio (UI) sobre o novo pre√ßo
            window.postMessage({ type: 'SANDX_PRICE_UPDATED', newPrice: valorSandx }, "*");
        }
    }
});

console.log("üöÄ SandxCDD AI Logistics Engine Ativo e Monitorando...");
</script>
</html>
</html>
